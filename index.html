<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QRコードリーダー</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  </head>
  <body>
    <button id="scanQR">QRコードをスキャン</button>
    <p>スキャン結果: <span id="result"></span></p>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        liff
          .init({ liffId: "2007108080-jR8JqOgX" }) // LIFF IDを設定
          .then(() => {
            document
              .getElementById("scanQR")
              .addEventListener("click", function () {
                if (!liff.isInClient()) {
                  alert("LINEアプリ内で開いてください");
                  return;
                }

                liff
                  .scanCodeV2()
                  .then((result) => {
                    const qrCodeData = result.value;
                    document.getElementById("result").textContent = qrCodeData;

                    if (isValidURL(qrCodeData)) {
                      window.location.href = qrCodeData;
                    } else {
                      alert("無効なQRコードです");
                    }
                  })
                  .catch((err) => {
                    console.log(err);
                  });
              });
          })
          .catch((err) => {
            console.error("LIFFの初期化に失敗:", err);
          });
      });

      function isValidURL(url) {
        try {
          new URL(url); // URLが有効な場合、エラーなしで通過する
          return true;
        } catch (e) {
          return false;
        }
      }
    </script>
  </body>
</html>
